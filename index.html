<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pawz</title>
    <link rel="stylesheet" href="/src/styles.css" />
  </head>
  <body>
    <div class="app">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-brand">
            <div class="sidebar-logo">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
              </svg>
            </div>
            <span class="sidebar-title">Pawz</span>
          </div>
        </div>
        
        <nav class="sidebar-nav">
          <div class="nav-section">
            <div class="nav-item active" data-view="dashboard">
              <svg class="icon" viewBox="0 0 24 24">
                <rect x="3" y="3" width="7" height="7" rx="1"/>
                <rect x="14" y="3" width="7" height="7" rx="1"/>
                <rect x="3" y="14" width="7" height="7" rx="1"/>
                <rect x="14" y="14" width="7" height="7" rx="1"/>
              </svg>
              <span>Home</span>
            </div>
            <div class="nav-item" data-view="today">
              <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <span>Today</span>
            </div>
            <div class="nav-item" data-view="chat">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
              </svg>
              <span>Chat</span>
            </div>
            <div class="nav-item" data-view="agents">
              <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="8" r="4"/>
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="19" cy="4" r="2" fill="currentColor"/>
              </svg>
              <span>Agents</span>
              <span class="nav-badge">New</span>
            </div>
          </div>

          <div class="nav-section">
            <div class="nav-section-label">Create</div>
            <div class="nav-item" data-view="tasks">
              <svg class="icon" viewBox="0 0 24 24">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <path d="M9 11l2 2 4-4"/>
                <line x1="3" y1="9" x2="21" y2="9"/>
              </svg>
              <span>Tasks</span>
              <span class="nav-badge">New</span>
            </div>
            <div class="nav-item" data-view="orchestrator">
              <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="5" r="3"/>
                <circle cx="5" cy="19" r="3"/>
                <circle cx="19" cy="19" r="3"/>
                <line x1="12" y1="8" x2="5" y2="16"/>
                <line x1="12" y1="8" x2="19" y2="16"/>
              </svg>
              <span>Orchestrator</span>
              <span class="nav-badge">New</span>
            </div>
            <div class="nav-item" data-view="code">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
              </svg>
              <span>Projects</span>
            </div>
            <div class="nav-item" data-view="content">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M12 20h9"/>
                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
              </svg>
              <span>Create</span>
            </div>
          </div>

          <div class="nav-section">
            <div class="nav-section-label">Automate</div>
            <div class="nav-item" data-view="mail">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <polyline points="22,6 12,13 2,6"/>
              </svg>
              <span>Mail</span>
            </div>
            <div class="nav-item" data-view="automations">
              <svg class="icon" viewBox="0 0 24 24">
                <polyline points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
              </svg>
              <span>Automate</span>
            </div>
            <div class="nav-item" data-view="channels">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M15 10l4.553-2.276A1 1 0 0 1 21 8.618v6.764a1 1 0 0 1-1.447.894L15 14"/>
                <rect x="1" y="6" width="14" height="12" rx="2"/>
              </svg>
              <span>Channels</span>
            </div>
            <div class="nav-item" data-view="research">
              <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
              </svg>
              <span>Research</span>
            </div>
            <div class="nav-item" data-view="nodes">
              <svg class="icon" viewBox="0 0 24 24">
                <rect x="2" y="2" width="20" height="8" rx="2" ry="2"/>
                <rect x="2" y="14" width="20" height="8" rx="2" ry="2"/>
                <line x1="6" y1="6" x2="6.01" y2="6"/>
                <line x1="6" y1="18" x2="6.01" y2="18"/>
              </svg>
              <span>Nodes</span>
            </div>
          </div>
          
          <div class="nav-section">
            <div class="nav-section-label">System</div>
            <div class="nav-item" data-view="memory">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
              </svg>
              <span>Memory</span>
            </div>
            <div class="nav-item" data-view="skills">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
              </svg>
              <span>Skills</span>
            </div>
            <div class="nav-item" data-view="foundry">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                <line x1="12" y1="22.08" x2="12" y2="12"/>
              </svg>
              <span>Foundry</span>
            </div>
            <div class="nav-item" data-view="settings">
              <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
              </svg>
              <span>Settings</span>
            </div>
          </div>
        </nav>
        
        <div class="sidebar-footer">
          <div class="status-indicator">
            <span class="status-dot" id="status-dot"></span>
            <span id="status-text">Connecting...</span>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main">

        <!-- ‚ïê‚ïê‚ïê Dashboard ‚ïê‚ïê‚ïê -->
        <div class="view dashboard-view" id="dashboard-view">
          <div class="dashboard-greeting">
            <h1>Welcome to Pawz</h1>
            <p>Your AI command center ‚Äî Pawz are safer than Claws</p>
          </div>

          <div class="quick-actions">
            <button class="quick-action" data-view="chat">
              <svg class="icon" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
              New Chat
            </button>
            <button class="quick-action" data-view="tasks">
              <svg class="icon" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 11l2 2 4-4"/><line x1="3" y1="9" x2="21" y2="9"/></svg>
              Tasks
            </button>
            <button class="quick-action" data-view="mail">
              <svg class="icon" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
              Check Mail
            </button>
            <button class="quick-action" id="wake-agent-btn">
              <svg class="icon" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
              Wake Agent
            </button>
          </div>

          <!-- Primary Features -->
          <div class="feature-section">
            <div class="feature-section-title">Start here</div>
            <div class="feature-grid primary">
              <button class="feature-card" data-view="chat">
                <div class="feature-card-icon orange">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                </div>
                <div class="feature-card-title">Chat</div>
                <div class="feature-card-desc">Talk to your agent ‚Äî ask anything, get answers, run tasks</div>
              </button>

              <button class="feature-card" data-view="tasks">
                <div class="feature-card-icon blue">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 11l2 2 4-4"/><line x1="3" y1="9" x2="21" y2="9"/></svg>
                </div>
                <div class="feature-card-title">Tasks</div>
                <div class="feature-card-desc">Kanban board ‚Äî assign tasks to agents and watch them work</div>
                <span class="feature-card-tag new">New</span>
              </button>

              <button class="feature-card" data-view="code">
                <div class="feature-card-icon purple">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/></svg>
                </div>
                <div class="feature-card-title">Code</div>
                <div class="feature-card-desc">Git repos, branches, PRs, code review ‚Äî managed by your agent</div>
              </button>
            </div>
          </div>

          <!-- Productivity -->
          <div class="feature-section">
            <div class="feature-section-title">Productivity</div>
            <div class="feature-grid secondary">
              <button class="feature-card" data-view="mail">
                <div class="feature-card-icon pink">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                </div>
                <div class="feature-card-title">Mail</div>
                <div class="feature-card-desc">Read, draft and send emails with approval guardrails</div>
                <span class="feature-card-tag new">New</span>
              </button>

              <button class="feature-card" data-view="automations">
                <div class="feature-card-icon yellow">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                </div>
                <div class="feature-card-title">Automate</div>
                <div class="feature-card-desc">Scheduled tasks, triggers, and recurring workflows</div>
              </button>

              <button class="feature-card" data-view="research">
                <div class="feature-card-icon cyan">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                </div>
                <div class="feature-card-title">Research</div>
                <div class="feature-card-desc">Browse the web, find data, compile reports automatically</div>
                <span class="feature-card-tag beta">Beta</span>
              </button>

              <button class="feature-card" data-view="content">
                <div class="feature-card-icon green">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                </div>
                <div class="feature-card-title">Create</div>
                <div class="feature-card-desc">Blog posts, social content, marketing copy, and more</div>
              </button>
            </div>
          </div>

          <!-- Connect & System -->
          <div class="feature-section">
            <div class="feature-section-title">Connect & Configure</div>
            <div class="feature-grid system">
              <button class="feature-card" data-view="channels">
                <div class="feature-card-icon orange">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M15 10l4.553-2.276A1 1 0 0 1 21 8.618v6.764a1 1 0 0 1-1.447.894L15 14"/><rect x="1" y="6" width="14" height="12" rx="2"/></svg>
                </div>
                <div class="feature-card-title">Channels</div>
                <div class="feature-card-desc">Telegram, Discord, WhatsApp, Signal</div>
              </button>

              <button class="feature-card" data-view="memory">
                <div class="feature-card-icon purple">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                </div>
                <div class="feature-card-title">Memory</div>
                <div class="feature-card-desc">Persistent knowledge that grows over time</div>
              </button>

              <button class="feature-card" data-view="skills">
                <div class="feature-card-icon cyan">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
                </div>
                <div class="feature-card-title">Skills</div>
                <div class="feature-card-desc">Install and manage agent abilities</div>
              </button>

              <button class="feature-card" data-view="foundry">
                <div class="feature-card-icon yellow">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
                </div>
                <div class="feature-card-title">Foundry</div>
                <div class="feature-card-desc">Choose models and manage your subscription</div>
                <span class="feature-card-tag pro">Pro</span>
              </button>
            </div>
          </div>

          <!-- Scheduled Tasks Widget -->
          <div class="feature-section" id="dashboard-cron-section" style="display:none">
            <div class="feature-section-title">
              <svg class="icon-sm" viewBox="0 0 24 24" style="display:inline;vertical-align:-2px;margin-right:4px"><polyline points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
              Scheduled Tasks
            </div>
            <div class="dash-cron-grid" id="dashboard-cron-list"></div>
            <div class="dash-cron-empty" id="dashboard-cron-empty" style="display:none">
              <span>No scheduled tasks running.</span>
              <button class="btn btn-ghost btn-sm" data-view="automations">Set up automations ‚Üí</button>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Onboarding ‚ïê‚ïê‚ïê -->
        <div class="view setup-view" id="setup-view">
          <div class="setup-card">
            <div class="setup-header">
              <div class="setup-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
              </div>
              <h1 class="setup-title">Welcome to Pawz</h1>
              <p class="setup-subtitle">Configure your AI provider to get started</p>
            </div>
            
            <div class="setup-options">

              
              <button class="setup-option" id="setup-new">
                <div class="setup-option-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="16"/>
                    <line x1="8" y1="12" x2="16" y2="12"/>
                  </svg>
                </div>
                <div class="setup-option-text">
                  <div class="setup-option-title">New Setup</div>
                  <div class="setup-option-desc">Set up Pawz from scratch</div>
                </div>
              </button>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Install View ‚ïê‚ïê‚ïê -->
        <div class="view setup-view" id="install-view">
          <div class="setup-card">
            <div class="setup-header">
              <div class="setup-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="7 10 12 15 17 10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
              </div>
              <h1 class="setup-title">Set Up Pawz</h1>
              <p class="setup-subtitle">We'll configure everything for you</p>
            </div>
            
            <div class="install-requirements">
              <div class="requirement-item" id="req-node">
                <svg class="icon-sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>
                <span>Node.js runtime</span>
              </div>
              <div class="requirement-item">
                <svg class="icon-sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>
                <span>Pawz engine</span>
              </div>
            </div>
            
            <div class="install-progress">
              <div class="progress-bar"><div class="progress-fill" id="install-progress-bar"></div></div>
              <p class="progress-text" id="install-progress-text">Ready to install</p>
            </div>
            
            <div class="btn-group">
              <button type="button" class="btn btn-secondary" id="install-back">Back</button>
              <button type="button" class="btn btn-primary" id="start-install">Install Now</button>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Manual Config ‚ïê‚ïê‚ïê -->
        <div class="view setup-view" id="manual-setup-view">
          <div class="setup-card">
            <div class="setup-header">
              <div class="setup-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <rect x="2" y="3" width="20" height="14" rx="2"/>
                  <line x1="8" y1="21" x2="16" y2="21"/>
                  <line x1="12" y1="17" x2="12" y2="21"/>
                </svg>
              </div>
              <h1 class="setup-title">Engine Configuration</h1>
              <p class="setup-subtitle">Enter your Pawz engine details</p>
            </div>
            

          </div>
        </div>


        <!-- ‚ïê‚ïê‚ïê Today View ‚ïê‚ïê‚ïê -->
        <div class="view today-view" id="today-view">
          <div class="today-content" id="today-content">
            <!-- Rendered by today.ts -->
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Agents View ‚ïê‚ïê‚ïê -->
        <div class="view agents-view" id="agents-view">
          <div class="view-header">
            <h1 class="view-title">Agents</h1>
            <button class="btn btn-primary btn-sm" id="agents-create-btn">
              <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              New Agent
            </button>
          </div>
          <div class="agents-grid" id="agents-grid">
            <!-- Agent cards render here -->
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Chat View ‚ïê‚ïê‚ïê -->
        <div class="view chat-view" id="chat-view">
          <div class="chat-header">
            <div class="chat-header-left">
              <div class="chat-avatar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="12" cy="8" r="5"/><path d="M20 21a8 8 0 1 0-16 0"/>
                </svg>
              </div>
              <div>
                <div class="chat-title" id="chat-agent-name">Agent</div>
                <div class="chat-subtitle" id="model-label">Connected</div>
              </div>
              <!-- Token meter -->
              <div class="token-meter" id="token-meter" title="Session token usage">
                <div class="token-meter-bar">
                  <div class="token-meter-fill" id="token-meter-fill"></div>
                </div>
                <span class="token-meter-label" id="token-meter-label">0 tokens</span>
              </div>
            </div>
            <div style="display:flex;gap:6px;align-items:center">
              <select class="chat-mode-select" id="chat-mode-select" title="Agent mode">
                <option value="">Default Mode</option>
              </select>
              <select class="chat-session-select" id="chat-session-select" title="Switch session"></select>
              <button class="btn btn-ghost btn-sm" id="session-rename-btn" title="Rename session">
                <svg class="icon-sm" viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
              </button>
              <button class="btn btn-ghost btn-sm" id="session-delete-btn" title="Delete session">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
              </button>
              <button class="btn btn-ghost btn-sm" id="session-clear-btn" title="Clear session history">
                <svg class="icon-sm" viewBox="0 0 24 24"><path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M5 6l1 14h12l1-14"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
              </button>
              <button class="btn btn-ghost btn-sm" id="session-compact-btn" title="Compact session storage">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/><line x1="14" y1="10" x2="21" y2="3"/><line x1="3" y1="21" x2="10" y2="14"/></svg>
              </button>
              <button class="btn btn-ghost" id="new-chat-btn" title="New Chat">
                <svg class="icon" viewBox="0 0 24 24">
                  <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Compaction warning banner -->
          <div class="compaction-warning" id="compaction-warning" style="display:none">
            <svg class="icon-sm" viewBox="0 0 24 24"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            <span id="compaction-warning-text">Context window filling up ‚Äî older messages may be compacted soon</span>
            <button class="btn btn-ghost btn-sm" id="compaction-warning-dismiss" title="Dismiss">√ó</button>
          </div>

          <!-- Session budget alert banner -->
          <div class="compaction-warning budget-alert" id="session-budget-alert" style="display:none">
            <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            <span id="session-budget-alert-text">Approaching budget limit</span>
            <button class="btn btn-ghost btn-sm" onclick="this.parentElement.style.display='none'" title="Dismiss">√ó</button>
          </div>
          
          <div class="chat-messages" id="chat-messages">
            <div class="empty-state" id="chat-empty">
              <div class="empty-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
              </div>
              <div class="empty-title">Start a conversation</div>
              <div class="empty-subtitle">Ask anything ‚Äî your agent is ready</div>
            </div>
          </div>
          
          <div class="chat-input-container">
            <div class="chat-attachment-preview" id="chat-attachment-preview" style="display:none"></div>
            <div class="chat-input-wrapper">
              <button class="chat-attach-btn" id="chat-attach-btn" title="Attach file" data-icon="paperclip"></button>
              <input type="file" id="chat-file-input" multiple accept="image/jpeg,image/png,image/gif,image/webp,.pdf,.txt,.md,.csv,.json,.xml,.yaml,.yml,.toml,.py,.rs,.js,.ts,.html,.css,.sh,.log,.c,.cpp,.h,.java,.rb,.go,.sql" style="display:none" />
              <textarea class="chat-input" id="chat-input" placeholder="Message your agent..." rows="1"></textarea>
              <button class="chat-send" id="chat-send" title="Send message" data-icon="arrow-up"></button>
            </div>
            <button class="chat-abort-btn" id="chat-abort-btn" style="display:none">
              <span data-icon="square"></span>
              Stop
            </button>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Tasks Hub ‚Äî Kanban Board ‚ïê‚ïê‚ïê -->
        <div class="view tasks-view" id="tasks-view">
          <div class="tasks-header">
            <div class="tasks-header-left">
              <h1 class="view-title">Tasks</h1>
              <p class="view-subtitle">Manage tasks across your agent workforce</p>
            </div>
            <div class="tasks-header-right">
              <div class="tasks-stats">
                <span class="tasks-stat" id="tasks-stat-total">0 tasks</span>
                <span class="tasks-stat-sep">¬∑</span>
                <span class="tasks-stat" id="tasks-stat-active">0 active</span>
                <span class="tasks-stat-sep">¬∑</span>
                <span class="tasks-stat" id="tasks-stat-cron">0 scheduled</span>
              </div>
              <button class="btn btn-primary btn-sm" id="tasks-add-btn">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                New Task
              </button>
            </div>
          </div>

          <div class="tasks-body">
            <!-- Kanban columns -->
            <div class="tasks-board" id="tasks-board">
              <div class="tasks-column" data-status="inbox">
                <div class="tasks-column-header">
                  <span class="tasks-column-icon">üì•</span>
                  <span class="tasks-column-title">Inbox</span>
                  <span class="tasks-column-count" id="tasks-count-inbox">0</span>
                  <button class="tasks-column-add" data-status="inbox" title="Add task">+</button>
                </div>
                <div class="tasks-column-cards" id="tasks-cards-inbox" data-status="inbox"></div>
              </div>

              <div class="tasks-column" data-status="assigned">
                <div class="tasks-column-header">
                  <span class="tasks-column-icon">üë§</span>
                  <span class="tasks-column-title">Assigned</span>
                  <span class="tasks-column-count" id="tasks-count-assigned">0</span>
                </div>
                <div class="tasks-column-cards" id="tasks-cards-assigned" data-status="assigned"></div>
              </div>

              <div class="tasks-column" data-status="in_progress">
                <div class="tasks-column-header">
                  <span class="tasks-column-icon">‚ö°</span>
                  <span class="tasks-column-title">In Progress</span>
                  <span class="tasks-column-count" id="tasks-count-in_progress">0</span>
                </div>
                <div class="tasks-column-cards" id="tasks-cards-in_progress" data-status="in_progress"></div>
              </div>

              <div class="tasks-column" data-status="review">
                <div class="tasks-column-header">
                  <span class="tasks-column-icon">üîç</span>
                  <span class="tasks-column-title">Review</span>
                  <span class="tasks-column-count" id="tasks-count-review">0</span>
                </div>
                <div class="tasks-column-cards" id="tasks-cards-review" data-status="review"></div>
              </div>

              <div class="tasks-column" data-status="blocked">
                <div class="tasks-column-header">
                  <span class="tasks-column-icon">üö´</span>
                  <span class="tasks-column-title">Blocked</span>
                  <span class="tasks-column-count" id="tasks-count-blocked">0</span>
                </div>
                <div class="tasks-column-cards" id="tasks-cards-blocked" data-status="blocked"></div>
              </div>

              <div class="tasks-column tasks-column-done" data-status="done">
                <div class="tasks-column-header">
                  <span class="tasks-column-icon">‚úÖ</span>
                  <span class="tasks-column-title">Done</span>
                  <span class="tasks-column-count" id="tasks-count-done">0</span>
                </div>
                <div class="tasks-column-cards" id="tasks-cards-done" data-status="done"></div>
              </div>
            </div>

            <!-- Live feed sidebar -->
            <div class="tasks-feed" id="tasks-feed">
              <div class="tasks-feed-header">
                <span class="tasks-feed-title">Live Feed</span>
                <div class="tasks-feed-tabs">
                  <button class="tasks-feed-tab active" data-feed="all">All</button>
                  <button class="tasks-feed-tab" data-feed="tasks">Tasks</button>
                  <button class="tasks-feed-tab" data-feed="status">Status</button>
                </div>
              </div>
              <div class="tasks-feed-list" id="tasks-feed-list">
                <div class="tasks-feed-empty">No activity yet</div>
              </div>
            </div>
          </div>

          <!-- Task detail modal (hidden by default) -->
          <div class="tasks-modal-overlay" id="tasks-detail-modal" style="display:none">
            <div class="tasks-modal">
              <div class="tasks-modal-header">
                <h2 class="tasks-modal-title" id="tasks-modal-title">Task</h2>
                <button class="btn-icon" id="tasks-modal-close">‚úï</button>
              </div>
              <div class="tasks-modal-body">
                <div class="tasks-modal-field">
                  <label>Title</label>
                  <input type="text" id="tasks-modal-input-title" class="input" placeholder="Task title">
                </div>
                <div class="tasks-modal-field">
                  <label>Description</label>
                  <textarea id="tasks-modal-input-desc" class="input" rows="4" placeholder="Describe what needs to be done..."></textarea>
                </div>
                <div class="tasks-modal-row">
                  <div class="tasks-modal-field">
                    <label>Priority</label>
                    <select id="tasks-modal-input-priority" class="input">
                      <option value="low">üü¢ Low</option>
                      <option value="medium" selected>üü° Medium</option>
                      <option value="high">üü† High</option>
                      <option value="urgent">üî¥ Urgent</option>
                    </select>
                  </div>
                  <div class="tasks-modal-field">
                    <label>Assign Agents</label>
                    <div id="tasks-modal-agents-tags" class="agent-tags-container"></div>
                    <select id="tasks-modal-input-agent" class="input" style="margin-top:6px">
                      <option value="">+ Add agent</option>
                    </select>
                    <div class="tasks-modal-hint">Click tag to toggle lead ‚òÖ / collaborator. First agent is lead by default.</div>
                  </div>
                </div>
                <div class="tasks-modal-field">
                  <label>Schedule (Cron)</label>
                  <div class="tasks-modal-cron-row">
                    <input type="text" id="tasks-modal-input-cron" class="input" placeholder="e.g. every 1h, daily 09:00">
                    <label class="tasks-modal-cron-toggle">
                      <input type="checkbox" id="tasks-modal-input-cron-enabled">
                      <span>Enabled</span>
                    </label>
                  </div>
                </div>
                <div class="tasks-modal-field" id="tasks-modal-activity-section" style="display:none">
                  <label>Activity</label>
                  <div class="tasks-modal-activity" id="tasks-modal-activity"></div>
                </div>
              </div>
              <div class="tasks-modal-footer">
                <button class="btn btn-ghost btn-sm" id="tasks-modal-delete" style="display:none">Delete</button>
                <div style="flex:1"></div>
                <button class="btn btn-ghost btn-sm" id="tasks-modal-run" style="display:none" title="Send task to agent now">
                  <svg class="icon-sm" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                  Run Now
                </button>
                <button class="btn btn-primary btn-sm" id="tasks-modal-save">Save</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Orchestrator ‚Äî Multi-Agent Projects ‚ïê‚ïê‚ïê -->
        <div class="view orchestrator-view" id="orchestrator-view">
          <div class="orchestrator-header">
            <div class="orchestrator-header-left">
              <h1 class="view-title">Orchestrator</h1>
              <p class="view-subtitle">Multi-agent project coordination</p>
            </div>
            <div class="orchestrator-header-right">
              <div class="orchestrator-stats">
                <span class="orchestrator-stat" id="orch-stat-total">0 projects</span>
                <span class="tasks-stat-sep">¬∑</span>
                <span class="orchestrator-stat" id="orch-stat-running">0 running</span>
              </div>
              <button class="btn btn-primary" id="orch-create-btn">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                New Project
              </button>
            </div>
          </div>

          <!-- Project list -->
          <div class="orchestrator-content">
            <div class="orch-project-list" id="orch-project-list">
              <div class="empty-state">
                <svg viewBox="0 0 24 24" width="48" height="48" stroke="currentColor" fill="none" stroke-width="1.5">
                  <circle cx="12" cy="5" r="3"/><circle cx="5" cy="19" r="3"/><circle cx="19" cy="19" r="3"/>
                  <line x1="12" y1="8" x2="5" y2="16"/><line x1="12" y1="8" x2="19" y2="16"/>
                </svg>
                <h3>No projects yet</h3>
                <p>Create a project to orchestrate multiple agents working together on a shared goal.</p>
              </div>
            </div>

            <!-- Project detail (hidden by default) -->
            <div class="orch-project-detail" id="orch-project-detail" style="display:none;">
              <div class="orch-detail-header">
                <button class="btn btn-ghost btn-sm" id="orch-back-btn">‚Üê Back</button>
                <div class="orch-detail-title">
                  <h2 id="orch-detail-name">Project Name</h2>
                  <span class="orch-status-badge" id="orch-detail-status">planning</span>
                </div>
                <div class="orch-detail-actions">
                  <button class="btn btn-primary btn-sm" id="orch-run-btn">‚ñ∂ Run</button>
                  <button class="btn btn-ghost btn-sm" id="orch-edit-btn">Edit</button>
                  <button class="btn btn-danger btn-sm" id="orch-delete-btn">Delete</button>
                </div>
              </div>
              <div class="orch-detail-goal" id="orch-detail-goal"></div>

              <!-- Agent roster -->
              <div class="orch-section">
                <div class="orch-section-header">
                  <h3>Agent Team</h3>
                  <button class="btn btn-ghost btn-sm" id="orch-add-agent-btn">+ Add Agent</button>
                </div>
                <div class="orch-agent-roster" id="orch-agent-roster"></div>
              </div>

              <!-- Message bus -->
              <div class="orch-section">
                <h3>Message Bus</h3>
                <div class="orch-message-bus" id="orch-message-bus">
                  <div class="empty-state-sm">No messages yet. Run the project to see agent communication.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Create/Edit Project Modal -->
          <div class="modal-overlay" id="orch-modal" style="display:none;">
            <div class="modal" style="max-width:560px;">
              <div class="modal-header">
                <h3 id="orch-modal-title">New Project</h3>
                <button class="modal-close" id="orch-modal-close">√ó</button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label>Project Title</label>
                  <input type="text" class="form-input" id="orch-form-title" placeholder="e.g. Build Landing Page">
                </div>
                <div class="form-group">
                  <label>Goal</label>
                  <textarea class="form-input" id="orch-form-goal" rows="4" placeholder="Describe what this project should achieve..."></textarea>
                </div>
                <div class="form-group">
                  <label>Boss Agent ID</label>
                  <input type="text" class="form-input" id="orch-form-boss" placeholder="default" value="default">
                  <small class="form-hint">The agent that orchestrates the project. Must have a soul file in the Foundry.</small>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-ghost" id="orch-modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="orch-modal-save">Create Project</button>
              </div>
            </div>
          </div>

          <!-- Add Agent Modal -->
          <div class="modal-overlay" id="orch-agent-modal" style="display:none;">
            <div class="modal" style="max-width:480px;">
              <div class="modal-header">
                <h3>Add Agent to Project</h3>
                <button class="modal-close" id="orch-agent-modal-close">√ó</button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label>Agent ID</label>
                  <input type="text" class="form-input" id="orch-agent-form-id" placeholder="e.g. coder-1">
                </div>
                <div class="form-group">
                  <label>Specialty</label>
                  <select class="form-input" id="orch-agent-form-specialty">
                    <option value="general">General</option>
                    <option value="coder">Coder</option>
                    <option value="researcher">Researcher</option>
                    <option value="designer">Designer</option>
                    <option value="communicator">Communicator</option>
                    <option value="security">Security</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Model <span style="font-weight:normal;color:var(--text-muted)">(optional ‚Äî uses routing config if blank)</span></label>
                  <input type="text" class="form-input" id="orch-agent-form-model" placeholder="e.g. gemini-2.0-flash" list="orch-model-datalist">
                  <datalist id="orch-model-datalist">
                    <option value="gemini-2.5-pro">
                    <option value="gemini-2.5-flash">
                    <option value="gemini-2.0-flash">
                    <option value="gemini-2.0-flash-lite">
                    <option value="gemini-1.5-pro">
                    <option value="gemini-1.5-flash">
                    <option value="gpt-4o">
                    <option value="gpt-4o-mini">
                    <option value="claude-sonnet-4-20250514">
                    <option value="claude-3-5-haiku-20241022">
                    <option value="claude-opus-4-20250514">
                  </datalist>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-ghost" id="orch-agent-modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="orch-agent-modal-save">Add Agent</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Projects View ‚Äî Local File Browser ‚ïê‚ïê‚ïê -->
        <div class="view projects-view" id="code-view">
          <div class="view-header">
            <h1 class="view-title">Projects</h1>
            <div style="display:flex;gap:6px">
              <button class="btn btn-primary btn-sm" id="projects-add-folder">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                Add Folder
              </button>
              <button class="btn btn-ghost btn-sm" id="projects-refresh-btn">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                Refresh
              </button>
            </div>
          </div>
          <div class="projects-layout">
            <div class="projects-sidebar">
              <div class="projects-sidebar-header">
                <span class="projects-sidebar-title">Folders</span>
              </div>
              <div class="projects-sidebar-list" id="projects-sidebar-list"></div>
            </div>
            <div class="projects-main">
              <div class="projects-file-tree" id="projects-file-tree"></div>
              <div class="projects-file-viewer" id="projects-file-viewer"></div>
              <div class="empty-state" id="projects-empty">
                <div class="empty-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                  </svg>
                </div>
                <div class="empty-title">Your Projects</div>
                <div class="empty-subtitle">Add a local folder to browse files your agent is working on</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Content View ‚Äî Create Studio ‚ïê‚ïê‚ïê -->
        <div class="view studio-view" id="content-view">
          <div class="studio-sidebar">
            <div class="studio-sidebar-header">
              <span class="studio-sidebar-title">Documents</span>
              <button class="btn-icon" id="content-new-doc" title="New document">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              </button>
            </div>
            <div class="studio-doc-list" id="content-doc-list">
              <div class="studio-doc-empty">No documents yet</div>
            </div>
          </div>
          <div class="studio-main">
            <div class="studio-toolbar" id="content-toolbar" style="display:none">
              <input class="studio-title-input" id="content-title" placeholder="Untitled document" />
              <div class="studio-toolbar-actions">
                <select class="studio-type-select" id="content-type">
                  <option value="markdown">Markdown</option>
                  <option value="html">HTML</option>
                  <option value="plaintext">Plain Text</option>
                </select>
                <button class="btn btn-ghost btn-sm" id="content-ai-improve" title="AI improve">
                  <svg class="icon-sm" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                  AI Improve
                </button>
                <button class="btn btn-primary btn-sm" id="content-save">Save</button>
                <button class="btn btn-ghost btn-sm btn-error" id="content-delete-doc" title="Delete document">Delete</button>
              </div>
            </div>
            <div class="studio-editor" id="content-editor-area">
              <div class="empty-state" id="content-empty">
                <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg></div>
                <div class="empty-title">Content studio</div>
                <div class="empty-subtitle">Create blog posts, marketing copy, documentation ‚Äî with AI assistance</div>
                <button class="btn btn-primary" id="content-create-first" style="margin-top:16px">Create Document</button>
              </div>
              <textarea class="studio-content-editor" id="content-body" style="display:none" placeholder="Start writing..."></textarea>
            </div>
            <div class="studio-word-count" id="content-word-count" style="display:none">0 words</div>
            <!-- Content scheduled tasks -->
            <div class="space-cron-widget space-cron-widget-inline" id="content-cron-widget" style="display:none">
              <div class="space-cron-header">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                <span>Publishing schedule</span>
                <span class="space-cron-count" id="content-cron-count">0</span>
              </div>
              <div class="space-cron-items" id="content-cron-items"></div>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Mail View ‚Äî Email Client ‚ïê‚ïê‚ïê -->
        <div class="view mail-client-view" id="mail-view">
          <div class="mail-sidebar">
            <div class="mail-sidebar-header">
              <button class="btn btn-primary btn-sm mail-compose-btn" id="mail-compose">
                <svg class="icon-sm" viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                Compose
              </button>
            </div>
            <div class="mail-folders">
              <div class="mail-folder active" data-folder="inbox">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></svg>
                <span>Inbox</span>
                <span class="mail-count" id="mail-inbox-count">0</span>
              </div>
              <div class="mail-folder" data-folder="drafts">
                <svg class="icon-sm" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                <span>Drafts</span>
              </div>
              <div class="mail-folder" data-folder="sent">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                <span>Sent</span>
              </div>
              <div class="mail-folder" data-folder="agent">
                <svg class="icon-sm" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                <span>Agent Drafts</span>
                <span class="mail-count mail-count-accent" id="mail-agent-count">0</span>
              </div>
            </div>
            <div class="mail-accounts-section">
              <div class="mail-accounts-header">
                <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                Credential Vault
              </div>
              <div id="mail-accounts-list">
                <div class="mail-no-accounts">No accounts connected</div>
              </div>
              <button class="btn btn-ghost btn-sm" id="mail-add-account" style="width:100%;margin-top:8px">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                Add Account
              </button>
            </div>
            <!-- Mail scheduled tasks -->
            <div class="space-cron-widget space-cron-widget-sidebar" id="mail-cron-widget" style="display:none">
              <div class="space-cron-header">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                <span>Digests</span>
                <span class="space-cron-count" id="mail-cron-count">0</span>
              </div>
              <div class="space-cron-items" id="mail-cron-items"></div>
            </div>
          </div>
          <div class="mail-list" id="mail-message-list">
            <div class="mail-list-header">
              <span class="mail-list-title" id="mail-folder-title">Inbox</span>
              <button class="btn btn-ghost btn-sm" id="mail-refresh">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
              </button>
            </div>
            <div class="mail-items" id="mail-items"></div>
            <div class="empty-state" id="mail-empty">
              <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>
              <div class="empty-title">Connect your email</div>
              <div class="empty-subtitle">Add an IMAP/SMTP account to read, draft, and send emails with AI assistance</div>
              <button class="btn btn-primary" id="mail-setup-account" style="margin-top:16px">Add Email Account</button>
            </div>
          </div>
          <div class="mail-preview" id="mail-preview">
            <div class="mail-preview-empty">Select an email to read</div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Automations View ‚Äî Card Board ‚ïê‚ïê‚ïê -->
        <div class="view auto-view" id="automations-view">
          <div class="view-header">
            <h1 class="view-title">Automations</h1>
            <div style="display:flex;gap:6px;align-items:center">
              <span class="cron-service-status" id="cron-service-status" title="Cron service status"></span>
              <button class="btn btn-ghost btn-sm" id="cron-view-toggle" title="Toggle view">
                <svg class="icon-sm" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
              </button>
              <button class="btn btn-primary btn-sm" id="add-cron-btn">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                New Automation
              </button>
            </div>
          </div>
          <div class="auto-board">
            <div class="auto-column">
              <div class="auto-column-header">
                <span class="auto-column-dot active"></span>
                <span>Active</span>
                <span class="auto-column-count" id="cron-active-count">0</span>
              </div>
              <div class="auto-column-cards" id="cron-active-cards"></div>
            </div>
            <div class="auto-column">
              <div class="auto-column-header">
                <span class="auto-column-dot paused"></span>
                <span>Paused</span>
                <span class="auto-column-count" id="cron-paused-count">0</span>
              </div>
              <div class="auto-column-cards" id="cron-paused-cards"></div>
            </div>
            <div class="auto-column">
              <div class="auto-column-header">
                <span class="auto-column-dot history"></span>
                <span>Run History</span>
              </div>
              <div class="auto-column-cards" id="cron-history-cards"></div>
            </div>
          </div>
          <div class="empty-state" id="cron-empty">
            <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></div>
            <div class="empty-title">No automations yet</div>
            <div class="empty-subtitle">Create scheduled tasks, triggers, and recurring workflows</div>
            <button class="btn btn-primary" id="cron-empty-add" style="margin-top:16px">Create First Automation</button>
          </div>
          <div class="view-loading" id="cron-loading" style="display:none">Loading automations‚Ä¶</div>
          <!-- Add/Edit Automation Modal -->
          <div class="modal-overlay" id="cron-modal" style="display:none">
            <div class="modal-card">
              <div class="modal-header">
                <h2 class="modal-title" id="cron-modal-title">New Automation</h2>
                <button class="btn-icon" id="cron-modal-close">‚úï</button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-input" id="cron-form-label" placeholder="My automation" />
                </div>
                <div class="form-group">
                  <label class="form-label">Schedule</label>
                  <select class="form-input" id="cron-form-schedule-preset">
                    <option value="">Custom cron...</option>
                    <option value="*/5 * * * *">Every 5 minutes</option>
                    <option value="*/15 * * * *">Every 15 minutes</option>
                    <option value="*/30 * * * *">Every 30 minutes</option>
                    <option value="0 * * * *">Every hour</option>
                    <option value="0 */6 * * *">Every 6 hours</option>
                    <option value="0 9 * * *">Daily at 9 AM</option>
                    <option value="0 9 * * 1">Weekly ‚Äî Monday 9 AM</option>
                    <option value="0 9 1 * *">Monthly ‚Äî 1st at 9 AM</option>
                  </select>
                  <input type="text" class="form-input" id="cron-form-schedule" placeholder="0 * * * *" style="margin-top:8px" />
                </div>
                <div class="form-group">
                  <label class="form-label">Task prompt</label>
                  <textarea class="form-input" id="cron-form-prompt" rows="3" placeholder="What should the agent do?"></textarea>
                </div>
                <div class="form-group">
                  <label class="form-label">Agent ID <span style="color:var(--text-muted);font-weight:normal">(optional)</span></label>
                  <input type="text" class="form-input" id="cron-form-agent" placeholder="default" />
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-secondary" id="cron-modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="cron-modal-save">Create</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Channels View ‚Äî Connection Hub ‚ïê‚ïê‚ïê -->
        <div class="view list-view" id="channels-view">
          <div class="view-header">
            <h1 class="view-title">Channels</h1>
            <div style="display:flex;gap:8px">
              <button class="btn btn-primary btn-sm" id="add-channel-btn">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                Add Channel
              </button>
              <button class="btn btn-ghost btn-sm" id="refresh-channels-btn">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                Refresh
              </button>
            </div>
          </div>
          <div class="channel-grid" id="channels-list"></div>

          <!-- Direct Send Message (channel send) -->
          <div class="channel-send-section" id="channel-send-section" style="display:none;margin-top:20px;border-top:1px solid var(--border-light);padding-top:16px">
            <h3 style="font-size:14px;font-weight:600;margin-bottom:8px">Send Direct Message</h3>
            <div style="display:flex;gap:8px;align-items:flex-end">
              <div style="flex:1">
                <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px">Channel</label>
                <select id="channel-send-target" class="settings-input" style="width:100%"></select>
              </div>
              <div style="flex:2">
                <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px">Message</label>
                <input type="text" id="channel-send-message" class="settings-input" placeholder="Type a message‚Ä¶" style="width:100%" />
              </div>
              <button class="btn btn-primary btn-sm" id="channel-send-btn">Send</button>
            </div>
          </div>

          <div class="empty-state" id="channels-empty">
            <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 10l4.553-2.276A1 1 0 0 1 21 8.618v6.764a1 1 0 0 1-1.447.894L15 14"/><rect x="1" y="6" width="14" height="12" rx="2"/></svg></div>
            <div class="empty-title">No channels configured</div>
            <div class="empty-subtitle">Connect your agent to messaging platforms ‚Äî chat with Paw from anywhere</div>
            <div class="channel-picker-grid" id="channels-picker-empty">
              <button class="channel-pick-btn" data-ch-type="telegram"><span class="channel-pick-icon telegram">TG</span><span>Telegram</span></button>
              <button class="channel-pick-btn" data-ch-type="discord"><span class="channel-pick-icon discord">DC</span><span>Discord</span></button>
              <button class="channel-pick-btn" data-ch-type="slack"><span class="channel-pick-icon slack">SL</span><span>Slack</span></button>
              <button class="channel-pick-btn" data-ch-type="matrix"><span class="channel-pick-icon matrix">MX</span><span>Matrix</span></button>
              <button class="channel-pick-btn" data-ch-type="irc"><span class="channel-pick-icon irc">IRC</span><span>IRC</span></button>
              <button class="channel-pick-btn" data-ch-type="mattermost"><span class="channel-pick-icon mattermost">MM</span><span>Mattermost</span></button>
              <button class="channel-pick-btn" data-ch-type="nextcloud"><span class="channel-pick-icon nextcloud">NC</span><span>Nextcloud</span></button>
              <button class="channel-pick-btn" data-ch-type="nostr"><span class="channel-pick-icon nostr">NS</span><span>Nostr</span></button>
              <button class="channel-pick-btn" data-ch-type="twitch"><span class="channel-pick-icon twitch">TW</span><span>Twitch</span></button>
            </div>
          </div>
          <div class="view-loading" id="channels-loading" style="display:none">Loading channels‚Ä¶</div>
        </div>

        <!-- Channel / Mail Setup Modal (global ‚Äî not inside any view) -->
        <div class="modal-overlay" id="channel-setup-modal" style="display:none">
          <div class="modal-card channel-setup-modal-inner">
            <div class="modal-header">
              <h2 id="channel-setup-title">Set Up Channel</h2>
              <button class="btn-icon" id="channel-setup-close">&times;</button>
            </div>
            <div class="modal-body" id="channel-setup-body">
              <!-- Filled dynamically -->
            </div>
            <div class="modal-footer">
              <button class="btn btn-ghost" id="channel-setup-cancel">Cancel</button>
              <button class="btn btn-primary" id="channel-setup-save">Save &amp; Connect</button>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Nodes View ‚Äî Device Management ‚ïê‚ïê‚ïê -->
        <div class="view nodes-layout" id="nodes-view">
          <div class="nodes-sidebar">
            <div class="nodes-sidebar-header">
              <span class="nodes-sidebar-title">Nodes</span>
              <button class="btn-icon" id="nodes-refresh" title="Refresh nodes">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
              </button>
            </div>
            <div class="nodes-list" id="nodes-list"></div>
            <div id="nodes-pairing-requests"></div>
          </div>
          <div class="nodes-main">
            <div class="nodes-toast" id="nodes-toast" style="display:none"></div>
            <div class="view-loading" id="nodes-loading" style="display:none">Loading nodes‚Ä¶</div>
            <div class="empty-state" id="nodes-empty" style="display:flex">
              <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg></div>
              <div class="empty-title">No nodes connected</div>
              <div class="empty-subtitle">Pair a device (iOS, Android, Mac) to use camera, location, clipboard, and more</div>
            </div>
            <div id="nodes-detail" style="display:none"></div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Research View ‚Äî Agent-powered research ‚ïê‚ïê‚ïê -->
        <div class="view" id="research-view">
          <!-- Sidebar: Projects + Recent -->
          <div class="research-sidebar">
            <div class="research-sidebar-header">
              <span class="research-sidebar-title">Research</span>
              <button class="btn-icon" id="research-new-project" title="New research project">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              </button>
            </div>
            
            <div class="research-sidebar-section">
              <div class="research-sidebar-label">Projects</div>
              <div class="research-project-list" id="research-project-list"></div>
            </div>
            
            <div class="research-sidebar-section">
              <div class="research-sidebar-label">Recent Queries</div>
              <div class="research-recent-list" id="research-recent-queries"></div>
            </div>
            
            <div class="research-sidebar-footer">
              <button class="btn btn-ghost btn-sm" id="research-open-workspace" title="Open in Finder">
                <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                </svg>
                Open Folder
              </button>
            </div>
          </div>
          
          <!-- Main content area -->
          <div class="research-main">
            <!-- Empty state -->
            <div class="research-empty-state" id="research-empty">
              <div class="research-empty-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="64" height="64">
                  <circle cx="11" cy="11" r="8"/>
                  <path d="M21 21l-4.35-4.35"/>
                  <path d="M11 8v6M8 11h6"/>
                </svg>
              </div>
              <h2 class="research-empty-title">Research Assistant</h2>
              <p class="research-empty-desc">Create a project, ask questions, and your AI agent will research the web ‚Äî gathering sources, extracting insights, and building a knowledge base you can explore.</p>
              <button class="btn btn-primary btn-lg" id="research-create-first">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                New Research Project
              </button>
              <p class="research-empty-hint">Your findings are saved as markdown files in ~/Documents/Paw</p>
            </div>
            
            <!-- Active project workspace -->
            <div class="research-workspace" id="research-workspace" style="display:none">
              <!-- Project header -->
              <div class="research-project-header" id="research-project-header"></div>
              
              <!-- Search bar with mode toggle -->
              <div class="research-search-bar">
                <div class="research-mode-toggle">
                  <button class="research-mode-btn active" id="research-mode-quick" title="Fast research (2-3 sources)">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                    Quick
                  </button>
                  <button class="research-mode-btn" id="research-mode-deep" title="Deep research (10+ sources)">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
                    Deep
                  </button>
                </div>
                <div class="research-input-wrapper">
                  <input type="text" class="research-topic-input" id="research-topic-input"
                         placeholder="What do you want to research?" autocomplete="off" />
                  <button class="btn btn-primary research-run-btn" id="research-run-btn">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                    Research
                  </button>
                  <button class="btn btn-error research-stop-btn" id="research-stop-btn" style="display:none">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="6" width="12" height="12"/></svg>
                    Stop
                  </button>
                </div>
              </div>
              
              <!-- Live research panel (shown during research) -->
              <div class="research-live-panel" id="research-live-panel" style="display:none">
                <div class="research-live-header">
                  <div class="research-live-title">
                    <div class="research-live-spinner"></div>
                    <span>Researching...</span>
                  </div>
                </div>
                
                <div class="research-live-body">
                  <!-- Progress steps -->
                  <div class="research-progress-steps" id="research-progress-steps"></div>
                  
                  <!-- Live source feed -->
                  <div class="research-live-sources">
                    <div class="research-live-sources-label">Sources being checked:</div>
                    <div class="research-source-feed" id="research-source-feed"></div>
                  </div>
                  
                  <!-- Live output stream -->
                  <div class="research-live-output">
                    <div class="research-live-output-label">Live output:</div>
                    <div class="research-live-content" id="research-live-content"></div>
                  </div>
                </div>
              </div>
              
              <!-- Findings + Sources layout -->
              <div class="research-content-layout" id="research-findings-area">
                <!-- Findings grid -->
                <div class="research-findings-section">
                  <div class="research-findings-header">
                    <h3>Findings</h3>
                    <button class="btn btn-primary btn-sm" id="research-generate-report">
                      <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                      </svg>
                      Generate Report
                    </button>
                  </div>
                  <div class="research-findings-grid" id="research-findings-grid"></div>
                </div>
                
                <!-- Sources panel -->
                <div class="research-sources-section">
                  <div class="research-sources-title">All Sources</div>
                  <div class="research-sources-panel" id="research-sources-panel"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Finding detail modal -->
          <div class="research-modal" id="research-detail-modal" style="display:none">
            <div class="research-modal-content research-modal-lg">
              <div class="research-modal-header">
                <h2>Finding Details</h2>
                <button class="btn-icon" id="research-detail-close">
                  <svg class="icon-sm" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
              </div>
              <div class="research-modal-body" id="research-detail-content"></div>
            </div>
          </div>
          
          <!-- Report modal -->
          <div class="research-modal" id="research-report-modal" style="display:none">
            <div class="research-modal-content research-modal-lg">
              <div class="research-modal-header">
                <h2>Research Report</h2>
                <button class="btn-icon" id="research-report-close">
                  <svg class="icon-sm" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
              </div>
              <div class="research-modal-body" id="research-report-content"></div>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Memory View ‚Äî Knowledge Base ‚ïê‚ïê‚ïê -->
        <div class="view palace-view" id="memory-view">
          <!-- Memory setup banner (shown when plugin not configured) -->
          <div class="palace-install-banner" id="palace-install-banner" style="display:none">
            <div class="palace-install-card">
              <div class="palace-install-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="48" height="48">
                  <path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7z"/>
                  <line x1="9" y1="21" x2="15" y2="21"/>
                  <line x1="10" y1="24" x2="14" y2="24"/>
                </svg>
              </div>
              <h2 class="palace-install-title">Enable Long-Term Memory</h2>
              <p class="palace-install-desc">
                Give your agent persistent vector memory with auto-capture and semantic recall.
                Works with OpenAI, Azure OpenAI, or any compatible endpoint ‚Äî just add your API key.
              </p>
              <div class="palace-api-config" id="palace-api-config">
                <label class="palace-api-label" for="palace-provider">
                  Provider <span class="palace-api-required">*</span>
                </label>
                <select class="palace-api-input palace-api-select" id="palace-provider">
                  <option value="openai">OpenAI</option>
                  <option value="azure">Azure OpenAI</option>
                </select>
                <label class="palace-api-label" for="palace-api-key">
                  API Key <span class="palace-api-required">*</span>
                </label>
                <input class="palace-api-input" id="palace-api-key" type="password"
                  placeholder="sk-..." autocomplete="off" spellcheck="false" />
                <div id="palace-azure-fields" style="display:none">
                  <label class="palace-api-label" for="palace-base-url">
                    Azure Endpoint <span class="palace-api-required">*</span>
                  </label>
                  <input class="palace-api-input" id="palace-base-url" type="text"
                    placeholder="https://your-resource.openai.azure.com" autocomplete="off" spellcheck="false" />
                  <p class="palace-api-hint" style="font-size:11px;margin:-6px 0 8px 0;opacity:0.6;">
                    Your Azure resource endpoint (e.g. https://myresource.openai.azure.com).
                  </p>
                </div>
                <div id="palace-openai-endpoint-field">
                  <label class="palace-api-label" for="palace-base-url-openai">
                    Custom Endpoint <span class="palace-api-hint">(optional ‚Äî leave blank for api.openai.com)</span>
                  </label>
                  <input class="palace-api-input" id="palace-base-url-openai" type="text"
                    placeholder="https://api.openai.com" autocomplete="off" spellcheck="false" />
                </div>
                <label class="palace-api-label" for="palace-model-name" id="palace-model-label">
                  Model <span class="palace-api-hint">(defaults to text-embedding-3-small)</span>
                </label>
                <input class="palace-api-input" id="palace-model-name" type="text"
                  placeholder="text-embedding-3-small" autocomplete="off" spellcheck="false" />
                <div id="palace-api-version-field" style="display:none">
                  <label class="palace-api-label" for="palace-api-version">
                    API Version <span class="palace-api-hint">(defaults to 2024-08-01-preview)</span>
                  </label>
                  <input class="palace-api-input" id="palace-api-version" type="text"
                    placeholder="2024-08-01-preview" autocomplete="off" spellcheck="false" />
                </div>
              </div>
              <div class="palace-install-progress" id="palace-install-progress" style="display:none">
                <p class="progress-text" id="palace-progress-text">Saving configuration‚Ä¶</p>
              </div>
              <div class="palace-install-actions">
                <div class="palace-btn-row">
                  <button class="btn btn-outline" id="palace-test-btn">Test Connection</button>
                  <button class="btn btn-primary" id="palace-install-btn">Enable Memory</button>
                </div>
                <button class="btn btn-ghost btn-sm" id="palace-skip-btn">Skip ‚Äî use file editor only</button>
              </div>
            </div>
          </div>
          <!-- Palace Sidebar -->
          <div class="palace-sidebar">
            <div class="palace-sidebar-header">
              <span class="palace-sidebar-title">Memory</span>
              <button class="btn-icon" id="palace-settings" title="Memory settings" style="display:none">
                <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
              </button>
              <button class="btn-icon" id="palace-export" title="Export all memories">
                <svg class="icon-sm" viewBox="0 0 24 24"><path d="M12 15V3"/><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><path d="m7 10 5 5 5-5"/></svg>
              </button>
              <button class="btn-icon" id="palace-refresh" title="Refresh memories">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
              </button>
            </div>
            <!-- Stats summary -->
            <div class="palace-stats" id="palace-stats">
              <div class="palace-stat">
                <span class="palace-stat-num" id="palace-total">‚Äî</span>
                <span class="palace-stat-label">Total</span>
              </div>
              <div class="palace-stat">
                <span class="palace-stat-num" id="palace-types">‚Äî</span>
                <span class="palace-stat-label">Types</span>
              </div>
              <div class="palace-stat">
                <span class="palace-stat-num" id="palace-graph-edges">‚Äî</span>
                <span class="palace-stat-label">Links</span>
              </div>
            </div>
            <!-- Filters -->
            <div class="palace-filters">
              <input class="palace-search-input" id="palace-search" placeholder="Search memories‚Ä¶" />
              <select class="palace-filter-select" id="palace-type-filter">
                <option value="">All types</option>
                <option value="fact">Facts</option>
                <option value="preference">Preferences</option>
                <option value="architecture">Architecture</option>
                <option value="decision">Decisions</option>
                <option value="insight">Insights</option>
                <option value="gotcha">Gotchas</option>
                <option value="event">Events</option>
                <option value="solution">Solutions</option>
              </select>
              <select class="palace-filter-select" id="palace-project-filter">
                <option value="">All projects</option>
              </select>
            </div>
            <!-- Memory list -->
            <div class="palace-memory-list" id="palace-memory-list">
              <div class="palace-list-empty" style="padding:12px;color:var(--text-muted);font-size:0.85rem">Loading‚Ä¶</div>
            </div>
            <!-- Agent file fallback section -->
            <div class="palace-section-divider" id="palace-files-divider">
              <span>Agent Files</span>
              <button class="btn-icon" id="refresh-memory-btn" title="Refresh files">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
              </button>
            </div>
            <div class="palace-memory-list" id="memory-list"></div>
          </div>
          <!-- Palace Main -->
          <div class="palace-main">
            <!-- Tabs: Recall / Graph / Remember / Files -->
            <div class="palace-tabs">
              <button class="palace-tab active" data-palace-tab="recall">
                <svg class="icon-sm" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                Recall
              </button>
              <button class="palace-tab" data-palace-tab="graph">
                <svg class="icon-sm" viewBox="0 0 24 24"><circle cx="6" cy="6" r="3"/><circle cx="18" cy="18" r="3"/><circle cx="18" cy="6" r="3"/><line x1="8.5" y1="7.5" x2="15.5" y2="16.5"/><line x1="15.5" y1="7.5" x2="8.5" y2="16.5"/></svg>
                Map
              </button>
              <button class="palace-tab" data-palace-tab="remember">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                Remember
              </button>
              <button class="palace-tab" data-palace-tab="files">
                <svg class="icon-sm" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                Files
              </button>
            </div>
            <!-- Recall Panel -->
            <div class="palace-panel active" id="palace-recall-panel">
              <div class="palace-recall-input-area">
                <textarea class="palace-recall-input" id="palace-recall-input" placeholder="Search by meaning‚Ä¶ e.g. 'How does authentication work?'" rows="2"></textarea>
                <button class="btn btn-primary btn-sm" id="palace-recall-btn">Recall</button>
              </div>
              <div class="palace-recall-results" id="palace-recall-results">
                <div class="empty-state" id="palace-recall-empty">
                  <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg></div>
                  <div class="empty-title">Semantic search</div>
                  <div class="empty-subtitle">Search your agent's memories by meaning ‚Äî not just keywords</div>
                </div>
              </div>
            </div>
            <!-- Graph Panel -->
            <div class="palace-panel" id="palace-graph-panel">
              <div class="palace-graph-container" id="palace-graph-canvas">
                <div class="empty-state" id="palace-graph-empty">
                  <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="6" cy="6" r="3"/><circle cx="18" cy="18" r="3"/><circle cx="18" cy="6" r="3"/><line x1="8.5" y1="7.5" x2="15.5" y2="16.5"/></svg></div>
                  <div class="empty-title">Knowledge graph</div>
                  <div class="empty-subtitle">Visual map of how your agent's memories connect to each other</div>
                </div>
                <canvas id="palace-graph-render" width="800" height="600" style="display:none"></canvas>
              </div>
            </div>
            <!-- Remember Panel -->
            <div class="palace-panel" id="palace-remember-panel">
              <div class="palace-remember-form">
                <div class="form-group">
                  <label class="form-label">Category</label>
                  <select class="form-input" id="palace-remember-type">
                    <option value="other">Other</option>
                    <option value="fact">Fact</option>
                    <option value="preference">Preference</option>
                    <option value="decision">Decision</option>
                    <option value="procedure">Procedure</option>
                    <option value="concept">Concept</option>
                    <option value="code">Code</option>
                    <option value="person">Person</option>
                    <option value="project">Project</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Content</label>
                  <textarea class="form-input" id="palace-remember-content" rows="5" placeholder="What should the agent remember?"></textarea>
                </div>
                <div class="form-group">
                  <label class="form-label">Importance (1‚Äì10)</label>
                  <select class="form-input" id="palace-remember-importance">
                    <option value="3">3 ‚Äì Low</option>
                    <option value="5" selected>5 ‚Äì Normal</option>
                    <option value="7">7 ‚Äì High</option>
                    <option value="10">10 ‚Äì Critical</option>
                  </select>
                </div>
                <button class="btn btn-primary" id="palace-remember-save" style="align-self:flex-start">
                  <svg class="icon-sm" viewBox="0 0 24 24" style="margin-right:4px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                  Store Memory
                </button>
              </div>
            </div>
            <!-- Files Panel (legacy agent files) -->
            <div class="palace-panel" id="palace-files-panel">
              <div class="memory-editor-panel" style="flex:1;display:flex;flex-direction:column">
                <div class="memory-editor" id="memory-editor" style="display:none">
                  <div class="memory-editor-header">
                    <span class="memory-editor-path" id="memory-editor-path"></span>
                    <div style="display:flex;gap:6px">
                      <button class="btn btn-ghost btn-sm" id="memory-editor-close">Close</button>
                      <button class="btn btn-primary btn-sm" id="memory-editor-save">Save</button>
                    </div>
                  </div>
                  <textarea class="memory-editor-content" id="memory-editor-content"></textarea>
                </div>
                <div class="empty-state" id="memory-empty">
                  <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>
                  <div class="empty-title">Agent files</div>
                  <div class="empty-subtitle">Raw filesystem used by your agent for persistent storage</div>
                </div>
              </div>
            </div>
          </div>
          <div class="view-loading" id="memory-loading" style="display:none">Loading memory‚Ä¶</div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Skills View ‚Äî Skill Vault ‚ïê‚ïê‚ïê -->
        <div class="view list-view" id="skills-view">
          <div class="view-header">
            <h1 class="view-title">
              <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:inline; vertical-align:middle; margin-right:6px"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
              Skills
            </h1>
            <div style="display:flex;gap:6px">
              <button class="btn btn-ghost btn-sm" id="refresh-skills-btn">
                <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                Refresh
              </button>
            </div>
          </div>
          <p style="color:var(--text-secondary); font-size:13px; margin-bottom:16px; padding: 0 4px;">
            Give your agent superpowers ‚Äî email, Slack, GitHub, REST APIs, webhooks. Credentials are encrypted and stored in your OS keychain. The agent never sees raw keys.
          </p>
          <!-- Status toast -->
          <div class="skills-toast" id="skills-toast" style="display:none"></div>
          <!-- Vault content -->
          <div id="skills-vault-loading" style="color:var(--text-muted); font-size:13px; padding:12px 0;">Loading skills...</div>
          <div id="skills-vault-list"></div>
          <div id="skills-vault-toast" style="display:none; margin-top:12px; padding:8px 14px; border-radius:8px; font-size:13px;"></div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Foundry View ‚Äî Models & Modes ‚ïê‚ïê‚ïê -->
        <div class="view list-view" id="foundry-view">
          <div class="view-header">
            <h1 class="view-title">Foundry</h1>
            <button class="btn btn-ghost btn-sm" id="refresh-models-btn">
              <svg class="icon-sm" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
              Refresh
            </button>
          </div>
          <div class="foundry-tabs">
            <button class="foundry-tab active" data-foundry-tab="models">Models</button>
            <button class="foundry-tab" data-foundry-tab="modes">Chat Modes</button>
          </div>
          <!-- Models Tab -->
          <div class="foundry-panel" id="foundry-models-panel">
            <div class="models-grid" id="models-list"></div>
            <div class="empty-state" id="models-empty">
              <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg></div>
              <div class="empty-title">No models available</div>
              <div class="empty-subtitle">Configure your AI provider in Settings to see available models</div>
            </div>
            <div class="view-loading" id="models-loading" style="display:none">Loading models‚Ä¶</div>
          </div>
          <!-- Agent Modes Tab -->
          <div class="foundry-panel" id="foundry-modes-panel" style="display:none">
            <div class="modes-header">
              <p class="modes-description">Agent modes are named configurations ‚Äî each with its own model, system prompt, and skill set.</p>
              <button class="btn btn-primary btn-sm" id="modes-add-btn">
                <svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                New Mode
              </button>
            </div>
            <div class="modes-list" id="modes-list"></div>
            <div class="empty-state" id="modes-empty" style="display:none">
              <div class="empty-title">No modes yet</div>
              <div class="empty-subtitle">Create modes to quickly switch your agent's behavior</div>
            </div>
          </div>
          <!-- Mode Editor Modal -->
          <div class="modal-overlay" id="mode-modal" style="display:none">
            <div class="modal-card modal-lg">
              <div class="modal-header">
                <h2 class="modal-title" id="mode-modal-title">New Agent Mode</h2>
                <button class="btn-icon" id="mode-modal-close">‚úï</button>
              </div>
              <div class="modal-body">
                <div class="form-row">
                  <div class="form-group" style="flex:0 0 60px">
                    <label class="form-label">Icon</label>
                    <input type="text" class="form-input form-input-icon" id="mode-form-icon" value="" maxlength="2" />
                  </div>
                  <div class="form-group" style="flex:1">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="mode-form-name" placeholder="Code Review" />
                  </div>
                  <div class="form-group" style="flex:0 0 100px">
                    <label class="form-label">Color</label>
                    <input type="color" class="form-input form-input-color" id="mode-form-color" value="#0073EA" />
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">Model (leave blank for default)</label>
                  <select class="form-input" id="mode-form-model">
                    <option value="">Default model</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">System Prompt</label>
                  <textarea class="form-input" id="mode-form-prompt" rows="4" placeholder="You are a careful code reviewer..."></textarea>
                </div>
                <div class="form-row">
                  <div class="form-group" style="flex:1">
                    <label class="form-label">Thinking Level</label>
                    <select class="form-input" id="mode-form-thinking">
                      <option value="none">None</option>
                      <option value="low">Low</option>
                      <option value="normal" selected>Normal</option>
                      <option value="high">High</option>
                    </select>
                  </div>
                  <div class="form-group" style="flex:1">
                    <label class="form-label">Temperature</label>
                    <input type="range" class="form-range" id="mode-form-temp" min="0" max="2" step="0.1" value="1" />
                    <span class="form-range-value" id="mode-form-temp-value">1.0</span>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-secondary" id="mode-modal-cancel">Cancel</button>
                <button class="btn btn-error btn-sm" id="mode-modal-delete" style="display:none">Delete</button>
                <button class="btn btn-primary" id="mode-modal-save">Save Mode</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Settings View ‚ïê‚ïê‚ïê -->
        <div class="view settings-view" id="settings-view">
          <h1 class="view-title" style="margin-bottom: 12px;">Settings</h1>

          <!-- Settings Tab Navigation -->
          <div class="settings-tab-bar" id="settings-tab-bar" style="display:flex; gap:4px; flex-wrap:wrap; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:8px">
            <button class="btn btn-ghost btn-sm settings-tab active" data-settings-tab="general">General</button>
            <button class="btn btn-ghost btn-sm settings-tab" data-settings-tab="models">Models</button>
            <button class="btn btn-ghost btn-sm settings-tab" data-settings-tab="env">Environment</button>
            <button class="btn btn-ghost btn-sm settings-tab" data-settings-tab="agent-defaults">Agent Defaults</button>
            <button class="btn btn-ghost btn-sm settings-tab" data-settings-tab="sessions">Sessions</button>
            <button class="btn btn-ghost btn-sm settings-tab" data-settings-tab="voice">Voice & TTS</button>
            <button class="btn btn-ghost btn-sm settings-tab" data-settings-tab="advanced">Advanced</button>
            <button class="btn btn-ghost btn-sm settings-tab" data-settings-tab="security">Security</button>
          </div>

          <!-- ‚îÄ‚îÄ Tab: General ‚îÄ‚îÄ -->
          <div class="settings-tab-panel" id="settings-panel-general">

          <!-- Pawz Engine ‚Äî AI Provider Config -->
          <div class="settings-section" id="settings-engine-section">
            <h2 class="settings-section-title">AI Provider</h2>
            <p class="settings-section-desc" style="margin-bottom:12px">Configure your AI provider and API key. Pawz calls APIs directly from your machine.</p>
            <!-- Hidden select kept for compatibility with settings-engine.ts -->
            <select class="form-input" id="settings-engine-mode" style="display:none">
              <option value="engine" selected>Built-in Paw Engine</option>
            </select>
            <div id="engine-config-panel">
              <div class="form-group">
                <label class="form-label">Provider</label>
                <select class="form-input" id="engine-provider-kind" style="max-width:300px">
                  <option value="anthropic">Anthropic (Claude)</option>
                  <option value="openai">OpenAI (GPT)</option>
                  <option value="google">Google (Gemini)</option>
                  <option value="openrouter">OpenRouter</option>
                  <option value="ollama">Ollama (Local)</option>
                  <option value="custom">Custom (OpenAI-compatible)</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">API Key</label>
                <input type="password" class="form-input" id="engine-api-key" placeholder="sk-..." />
              </div>
              <div class="form-group">
                <label class="form-label">Model</label>
                <input type="text" class="form-input" id="engine-model" placeholder="claude-sonnet-4-20250514" style="max-width:400px" />
              </div>
              <div class="form-group" id="engine-base-url-group" style="display:none">
                <label class="form-label">Base URL (optional)</label>
                <input type="text" class="form-input" id="engine-base-url" placeholder="https://api.openai.com/v1" style="max-width:500px" />
              </div>
              <button class="btn btn-primary" id="engine-save-btn">Save Engine Settings</button>
              <span id="engine-save-status" style="margin-left:12px; color:var(--text-muted); font-size:13px;"></span>
            </div>
          </div>
          
          <div class="settings-section">
            <h2 class="settings-section-title">About</h2>
            <p style="color: var(--text-secondary); font-size: 13px; line-height: 1.8;">
              <strong>Pawz</strong> v0.1.0 ‚Äî Your AI command center<br>
              Pawz are safer than Claws üêæ<br>
              <a href="https://github.com/elisplash/paw" target="_blank" style="color: var(--accent);">View source on GitHub</a>
            </p>
          </div>

          </div><!-- end settings-panel-general -->

          <!-- ‚îÄ‚îÄ Tab: Models ‚îÄ‚îÄ -->
          <div class="settings-tab-panel" id="settings-panel-models" style="display:none">
            <div class="settings-section" id="settings-models-section">
              <h2 class="settings-section-title">Models &amp; Providers</h2>
              <p class="settings-section-desc">Manage AI providers and models ‚Äî add Ollama, OpenAI, Anthropic, Google, OpenRouter, and more.</p>
              <div id="settings-models-content"></div>
            </div>
          </div>

          <!-- ‚îÄ‚îÄ Tab: Environment ‚îÄ‚îÄ -->
          <div class="settings-tab-panel" id="settings-panel-env" style="display:none">
            <div class="settings-section" id="settings-env-section">
              <h2 class="settings-section-title">API Keys &amp; Environment</h2>
              <p class="settings-section-desc">Provider API keys, skill credentials, and system environment.</p>
              <div id="settings-env-content"></div>
            </div>
          </div>

          <!-- ‚îÄ‚îÄ Tab: Agent Defaults ‚îÄ‚îÄ -->
          <div class="settings-tab-panel" id="settings-panel-agent-defaults" style="display:none">
            <div class="settings-section" id="settings-agent-defaults-section">
              <h2 class="settings-section-title">Agent Defaults</h2>
              <p class="settings-section-desc">Default model, tool execution limits, system prompt, and memory settings.</p>
              <div id="settings-agent-defaults-content"></div>
            </div>
          </div>

          <!-- ‚îÄ‚îÄ Tab: Sessions ‚îÄ‚îÄ -->
          <div class="settings-tab-panel" id="settings-panel-sessions" style="display:none">
            <div class="settings-section" id="settings-sessions-section">
              <h2 class="settings-section-title">Sessions</h2>
              <p class="settings-section-desc">View, rename, and manage chat sessions.</p>
              <div id="settings-sessions-content"></div>
            </div>
          </div>

          <!-- ‚îÄ‚îÄ Tab: Voice & TTS ‚îÄ‚îÄ -->
          <div class="settings-tab-panel" id="settings-panel-voice" style="display:none">
            <div class="settings-section" id="settings-voice-section">
              <h2 class="settings-section-title">Voice &amp; TTS</h2>
              <p class="settings-section-desc">Text-to-speech, talk mode, and voice wake triggers.</p>
              <div id="settings-voice-content"></div>
            </div>
          </div>

          <!-- ‚îÄ‚îÄ Tab: Advanced ‚îÄ‚îÄ -->
          <div class="settings-tab-panel" id="settings-panel-advanced" style="display:none">
            <div class="settings-section" id="settings-advanced-section">
              <h2 class="settings-section-title">Advanced Configuration</h2>
              <p class="settings-section-desc">Ollama setup, provider configuration, tool limits, and system prompt.</p>
              <div id="settings-advanced-content"></div>
            </div>
          </div>

          <!-- ‚îÄ‚îÄ Tab: Security ‚îÄ‚îÄ -->
          <div class="settings-tab-panel" id="settings-panel-security" style="display:none">

          <!-- Exec Approvals Config -->
          <div class="settings-section" id="settings-approvals-section" style="display:none">
            <h2 class="settings-section-title">Tool Approval Rules</h2>
            <p class="settings-section-desc">Choose which tools your agent can use automatically and which need your permission.</p>
            
            <!-- Default behaviour radio group -->
            <div class="approvals-default-policy">
              <div class="approvals-policy-label">When a tool isn't listed below:</div>
              <div class="approvals-policy-options" id="approvals-ask-policy">
                <label class="approvals-policy-option">
                  <input type="radio" name="approvals-policy" value="ask" checked />
                  <div class="approvals-policy-card">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                    <span>Ask me</span>
                  </div>
                </label>
                <label class="approvals-policy-option">
                  <input type="radio" name="approvals-policy" value="allow" />
                  <div class="approvals-policy-card">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    <span>Allow</span>
                  </div>
                </label>
                <label class="approvals-policy-option">
                  <input type="radio" name="approvals-policy" value="deny" />
                  <div class="approvals-policy-card">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>
                    <span>Block</span>
                  </div>
                </label>
              </div>
            </div>

            <!-- Tool rules list (rendered dynamically) -->
            <div class="approvals-tool-list" id="approvals-tool-list">
              <!-- Each tool rendered as a row with a 3-way toggle -->
            </div>

            <button class="btn btn-ghost btn-sm" id="approvals-add-tool" style="margin-top:8px">
              <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              Add rule
            </button>

            <div style="display:flex;gap:8px;margin-top:16px">
              <button class="btn btn-primary" id="settings-save-approvals">Save Rules</button>
              <button class="btn btn-ghost btn-sm" id="settings-refresh-approvals">Reload</button>
            </div>
          </div>

          <!-- Security Audit Dashboard -->
          <div class="settings-section" id="settings-audit-section">
            <h2 class="settings-section-title">
              <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
              Security Audit Log
            </h2>
            <p class="settings-section-desc">All security-relevant events ‚Äî exec approvals, auto-denies, auto-allows, and policy changes.</p>

            <!-- Encryption status indicator (C2) -->
            <div class="encryption-status-bar" id="encryption-status-bar">
              <span class="encryption-status-dot" id="encryption-status-dot"></span>
              <span id="encryption-status-text">Checking encryption...</span>
            </div>

            <div class="audit-controls">
              <select class="form-input audit-filter-select" id="audit-filter-type">
                <option value="">All events</option>
                <option value="exec_approval">Exec approvals</option>
                <option value="auto_deny">Auto-denied</option>
                <option value="auto_allow">Auto-allowed</option>
                <option value="credential_access">Credential access</option>
                <option value="security_policy">Policy changes</option>
                <option value="network_request">Network requests</option>
                <option value="engine_crash">Engine crashes</option>
                <option value="scope_violation">Scope violations</option>
              </select>
              <select class="form-input audit-filter-select" id="audit-filter-risk">
                <option value="">All risk levels</option>
                <option value="critical">Critical</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
                <option value="safe">Safe</option>
              </select>
              <select class="form-input audit-filter-select" id="audit-filter-limit">
                <option value="50">Last 50</option>
                <option value="100" selected>Last 100</option>
                <option value="250">Last 250</option>
                <option value="500">Last 500</option>
              </select>
              <button class="btn btn-ghost btn-sm" id="audit-refresh">Refresh</button>
              <button class="btn btn-ghost btn-sm" id="audit-export-json" title="Export as JSON">Export JSON</button>
              <button class="btn btn-ghost btn-sm" id="audit-export-csv" title="Export as CSV">Export CSV</button>
            </div>

            <!-- Security score card -->
            <div class="audit-score-card" id="audit-score-card">
              <div class="audit-score-item" id="audit-score-csp">
                <span class="audit-score-icon">‚úÖ</span>
                <span class="audit-score-label">CSP Active</span>
              </div>
              <div class="audit-score-item" id="audit-score-denied">
                <span class="audit-score-icon">üõ°</span>
                <span class="audit-score-label" id="audit-score-denied-label">0 blocked</span>
              </div>
              <div class="audit-score-item" id="audit-score-allowed">
                <span class="audit-score-icon">‚úì</span>
                <span class="audit-score-label" id="audit-score-allowed-label">0 allowed</span>
              </div>
              <div class="audit-score-item" id="audit-score-critical">
                <span class="audit-score-icon">‚ö†</span>
                <span class="audit-score-label" id="audit-score-critical-label">0 critical</span>
              </div>
            </div>

            <div class="audit-table-wrapper" id="audit-table-wrapper">
              <table class="audit-table" id="audit-log-table">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Event</th>
                    <th>Risk</th>
                    <th>Tool</th>
                    <th>Detail</th>
                    <th>Result</th>
                  </tr>
                </thead>
                <tbody id="audit-log-body"></tbody>
              </table>
            </div>
            <div class="audit-empty" id="audit-empty" style="display:none">No security events recorded yet.</div>
          </div>

          <!-- Security Policies -->
          <div class="settings-section" id="settings-security-section">
            <h2 class="settings-section-title">
              <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
              Security Policies
            </h2>
            <p class="settings-section-desc">Controls how Paw handles dangerous commands from the agent.</p>

            <!-- Session override banner -->
            <div class="session-override-banner" id="session-override-banner" style="display:none">
              <div class="session-override-banner-text">
                <span class="session-override-banner-icon">‚è±</span>
                <span id="session-override-banner-label">Session override active</span>
              </div>
              <button class="btn btn-ghost btn-sm" id="session-override-cancel">Cancel Override</button>
            </div>

            <div class="security-toggles">
              <label class="security-toggle-row">
                <input type="checkbox" id="sec-auto-deny-priv" />
                <div class="security-toggle-info">
                  <div class="security-toggle-label">Auto-deny privilege escalation</div>
                  <div class="security-toggle-desc">Automatically block sudo, su, doas, pkexec, and runas commands without asking</div>
                </div>
              </label>
              <label class="security-toggle-row">
                <input type="checkbox" id="sec-auto-deny-critical" />
                <div class="security-toggle-info">
                  <div class="security-toggle-label">Auto-deny all critical-risk commands</div>
                  <div class="security-toggle-desc">Automatically block fork bombs, remote code execution, disk destruction, etc.</div>
                </div>
              </label>
              <label class="security-toggle-row">
                <input type="checkbox" id="sec-require-type" checked />
                <div class="security-toggle-info">
                  <div class="security-toggle-label">Require typing "ALLOW" for critical commands</div>
                  <div class="security-toggle-desc">Instead of clicking a button, you must type ALLOW to approve dangerous commands</div>
                </div>
              </label>
              <label class="security-toggle-row">
                <input type="checkbox" id="sec-read-only-projects" />
                <div class="security-toggle-info">
                  <div class="security-toggle-label">Read-only project mode</div>
                  <div class="security-toggle-desc">Block agent filesystem write tools (create, edit, delete, move) ‚Äî the agent can only read files</div>
                </div>
              </label>
            </div>

            <h3 class="settings-subsection-title" style="margin-top:20px">Token Auto-Rotation</h3>
            <p class="settings-section-desc">Automatically rotate device tokens after a set number of days. Set to 0 to disable.</p>
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
              <select class="form-input" id="sec-token-rotation-interval" style="width:200px">
                <option value="0">Disabled</option>
                <option value="7">Every 7 days</option>
                <option value="14">Every 14 days</option>
                <option value="30">Every 30 days</option>
                <option value="60">Every 60 days</option>
                <option value="90">Every 90 days</option>
              </select>
              <span class="settings-section-desc" id="sec-token-rotation-status" style="margin:0"></span>
            </div>

            <h3 class="settings-subsection-title" style="margin-top:20px">Command Allowlist</h3>
            <p class="settings-section-desc">Regex patterns for commands that are always auto-approved (bypasses the approval modal). One pattern per line.</p>
            <textarea class="form-input security-patterns-input" id="sec-allowlist" rows="6" placeholder="^git\b&#10;^npm\b&#10;^ls\b"></textarea>

            <h3 class="settings-subsection-title" style="margin-top:16px">Command Denylist</h3>
            <p class="settings-section-desc">Regex patterns for commands that are always auto-denied. One pattern per line.</p>
            <textarea class="form-input security-patterns-input" id="sec-denylist" rows="6" placeholder="\bsudo\b&#10;\brm\s+-rf\s+/"></textarea>

            <div style="display:flex;gap:8px;margin-top:16px">
              <button class="btn btn-primary" id="settings-save-security">Save Security Policies</button>
              <button class="btn btn-ghost btn-sm" id="settings-reset-security">Reset to Defaults</button>
            </div>
          </div>

          </div><!-- end settings-panel-security -->

        </div>
      </main>
    </div>

    <!-- Global Toast -->
    <div class="global-toast" id="global-toast" style="display:none"></div>

    <!-- Exec Approval Modal -->
    <div class="modal-overlay" id="approval-modal" style="display:none">
      <div class="modal-card" id="approval-modal-card" style="width:480px">
        <div class="modal-header" id="approval-modal-header">
          <h2 class="modal-title" id="approval-modal-title">Tool Approval Required</h2>
          <button class="btn-icon" id="approval-modal-close">‚úï</button>
        </div>
        <!-- Risk badge (hidden by default, shown for dangerous commands) -->
        <div class="approval-risk-banner" id="approval-risk-banner" style="display:none">
          <div class="approval-risk-icon" id="approval-risk-icon">‚ö†</div>
          <div class="approval-risk-info">
            <div class="approval-risk-label" id="approval-risk-label">DANGER</div>
            <div class="approval-risk-reason" id="approval-risk-reason"></div>
          </div>
        </div>
        <!-- Network request audit banner (C5) -->
        <div id="approval-network-banner" class="network-banner" style="display:none"></div>
        <div class="modal-body">
          <p id="approval-modal-desc" style="color:var(--text-secondary);margin-bottom:12px"></p>
          <div id="approval-modal-details" class="approval-details"></div>
        </div>
        <div class="modal-footer" id="approval-modal-footer">
          <!-- Session override dropdown -->
          <div class="session-override-group" id="session-override-group">
            <button class="btn btn-ghost btn-sm" id="session-override-btn" title="Approve all requests for a limited time">‚è± Allow all‚Ä¶</button>
            <div class="session-override-menu" id="session-override-menu" style="display:none">
              <button class="session-override-opt" data-minutes="30">30 minutes</button>
              <button class="session-override-opt" data-minutes="60">1 hour</button>
              <button class="session-override-opt" data-minutes="120">2 hours</button>
            </div>
          </div>
          <button class="btn btn-secondary" id="approval-deny-btn">Deny</button>
          <!-- Type-to-confirm container (hidden by default, shown for critical commands) -->
          <div class="approval-type-confirm" id="approval-type-confirm" style="display:none">
            <label class="approval-type-label">Type <strong>ALLOW</strong> to approve:</label>
            <input type="text" class="form-input approval-type-input" id="approval-type-input" placeholder="Type ALLOW" autocomplete="off" spellcheck="false" />
          </div>
          <button class="btn btn-primary" id="approval-allow-btn">Allow</button>
        </div>
      </div>
    </div>

    <!-- Generic Prompt Modal (replaces window.prompt which doesn't work in Tauri webview) -->
    <div class="modal-overlay" id="prompt-modal" style="display:none">
      <div class="modal-card" style="width:420px">
        <div class="modal-header">
          <h2 class="modal-title" id="prompt-modal-title">Input</h2>
          <button class="btn-icon" id="prompt-modal-close">‚úï</button>
        </div>
        <div class="modal-body">
          <input type="text" class="form-input" id="prompt-modal-input" placeholder="" autocomplete="off" />
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="prompt-modal-cancel">Cancel</button>
          <button class="btn btn-primary" id="prompt-modal-ok">OK</button>
        </div>
      </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
